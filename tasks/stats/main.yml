- name: install goaccess packages
  package:
    pkg:
      - goaccess
      - geoip-database
      - geoip-database-extra

- name: deploy goaccess.conf
  copy:
    src: goaccess.conf
    dest: /etc/goaccess/goaccess.conf

- name: deploy goaccess-last wrapper
  copy:
    src: goaccess-last
    dest: /usr/local/bin/goaccess-last
    mode: '0755'

- name: create goaccess b-tree database directory
  file:
    path: /var/lib/goaccess/global
    state: directory

- name: create website-statistics directory
  file:
    path: /var/www/default/website-statistics/global
    state: directory

- name: create goaccess cronjob
  template:
    src: '{{ webserver_tls_terminator }}/log/website-statistics.j2'
    dest: /etc/cron.daily/website-statistics
    mode: '0755'

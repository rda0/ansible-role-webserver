<IfModule ldap_module>
    LDAPTrustedGlobalCert CA_BASE64 {{ webserver_ldap_trusted_ca_cert }}
    LDAPVerifyServerCert On
    LDAPTrustedMode TLS
    LDAPSharedCacheSize 500000
    LDAPCacheEntries 1024
    LDAPCacheTTL 600
    LDAPOpCacheEntries 1024
    LDAPOpCacheTTL 600

    <Macro PhysLDAP>
        AuthType Basic
        AuthName "ETH D-PHYS Account"
        AuthBasicProvider ldap
        AuthLDAPURL "ldap://ldap3.phys.ethz.ch ldap2.phys.ethz.ch ldap1.phys.ethz.ch/ou=people,dc=phys,dc=ethz,dc=ch?uid?one?(&(objectClass=dphysUser)(!(blocked=yes)))" TLS
        AuthLDAPGroupAttribute memberUid
        AuthLDAPGroupAttributeIsDN off
    </Macro>

    <Macro RequirePhysLDAPGroup $groupname>
        Require ldap-group cn=$groupname,ou=groups,dc=phys,dc=ethz,dc=ch
    </Macro>
{% if webserver_ldap_ethz %}

    <Macro ETHLDAP>
        AuthType Basic
        AuthName "ETH Account"
        AuthBasicProvider ldap
        AuthLDAPUrl "ldaps://ldaps-hit-1.ethz.ch ldaps-hit-2.ethz.ch ldaps-rz-1.ethz.ch ldaps-rz-2.ethz.ch/ou=users,ou=nethz,ou=id,ou=auth,o=ethz,c=ch?uid?one?(objectClass=*)"
        AuthLDAPBindDN "cn=dphys_web_proxy,ou=admins,ou=nethz,ou=id,ou=auth,o=ethz,c=ch"
        AuthLDAPBindPassword "c4d2n.fg9.ag33s.g84cc"
        SetEnv dontloglastuse
    </Macro>
{% endif %}
</IfModule>
